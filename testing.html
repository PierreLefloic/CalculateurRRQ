<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CSV Data Analysis with Pyodide</title>
  <script src="https://cdn.jsdelivr.net/pyodide/v0.26.1/full/pyodide.js"></script>
</head>
<body>
  <h2>CSV Data Analysis (Python in Browser)</h2>

  <input type="file" id="file-input" accept=".csv">
  <button id="analyze-btn">Analyze</button>

  <pre id="output"></pre>

  <script type="text/javascript">
    let pyodideReadyPromise = loadPyodide({
      indexURL: "https://cdn.jsdelivr.net/pyodide/v0.26.1/full/"
    });

    async function loadPythonScript(pyodide, path) {
      let response = await fetch(path);
      let code = await response.text();
      pyodide.runPython(code);  // loads functions into the Python environment
    }

    document.getElementById("analyze-btn").addEventListener("click", async () => {
      let fileInput = document.getElementById("file-input");
      if (fileInput.files.length === 0) {
        alert("Please select a CSV file first!");
        return;
      }

      let file = fileInput.files[0];
      let text = await file.text();

      let pyodide = await pyodideReadyPromise;
      await pyodide.loadPackage("pandas");

      // Load external Python script (analysis.py)
      await loadPythonScript(pyodide, "analysis.py");

      // Call the analyze() function defined in analysis.py
      let result = await pyodide.runPythonAsync(`
from js import text
analyze(text)
      `, { globals: { text } });

      document.getElementById("output").textContent = result;
    });
  </script>
</body>
</html>
