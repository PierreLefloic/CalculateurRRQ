<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Calculateur TRI</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="logo-wrapper">
    <img src="img/logo_CFFP.png" alt="Logo" class="logo">
  </div>

  <div class="header-box">
    <h1 class="title">Calculateur TRI</h1>
    <p class="description">Calculez le Taux de Rendement Interne de vos investissements avec notre outil professionnel. Entrez vos données et obtenez une analyse détaillée de vos projets financiers.</p>
  </div>

  <div class="container-row">
    <div class="left-column">
      <div class="container">
        <!-- <h2>Simulation Tool</h2> -->
        <div class="input-grid">
          <label for="inputBirth">Date de naissance :</label>
          <input id="inputBirth" type="date" max="9999-12-31">
          <label for="inputCurrentYear">Année courante :</label>
          <input id="inputCurrentYear" type="number" value="2025" min="1900" max="2100" placeholder="YYYY">
        </div>

          <!-- <label for="inputA">Input A:</label>
          <input id="inputA" type="number" value="5">
          <label for="inputB">Input B:</label>
          <input id="inputB" type="number" value="3">
          <button type="button" onclick="runCalc()" class="full-width">Run Simulation</button>
          <p class="full-width">Result: <span id="output">-</span></p>
        </form> -->
      </div>

      <div class="container">
        <h2>Salaire</h2>
        <div class="input-grid">
          <label for="BeforeCurrentYear">Avant année courante (%) :</label>
          <input id="BeforeCurrentYear" type="number" value="114" min="0" max="200">
          <label for="AfterCurrentYear">Après année courante (%) :</label>
          <input id="AfterCurrentYear" type="number" value="114" min="0" max="200">
        </div>
      </div>
      
      <div class="container">
        <h2>Paramètres RRQ</h2>
        <div class="input-grid">
          <label for="RetAge">Âge de retraite :</label>
          <select id="RetAge">
            <option value="60">60</option>
            <option value="61">61</option>
            <option value="62">62</option>
            <option value="63">63</option>
            <option value="64">64</option>
            <option value="65" selected>65</option>
            <option value="66">66</option>
            <option value="67">67</option>
            <option value="68">68</option>
            <option value="69">69</option>
            <option value="70">70</option>
            <option value="71">71</option>
            <option value="72">72</option>
          </select>
          <label for="BenAge">Âge de la demande de prestation :</label>
          <select id="BenAge">
            <option value="60">60</option>
            <option value="61">61</option>
            <option value="62">62</option>
            <option value="63">63</option>
            <option value="64">64</option>
            <option value="65" selected>65</option>
            <option value="66">66</option>
            <option value="67">67</option>
            <option value="68">68</option>
            <option value="69">69</option>
            <option value="70">70</option>
            <option value="71">71</option>
            <option value="72">72</option>
          </select>
          <label for="AgeExp">Espérance de vie :</label>
          <input id="AgeExp" type="number" value="85" min="60" max="120">

        </div>
      </div>
      
      <button id="launchSimulation">Lancer la simulation</button>
    </div>
    
    <div class="right-column">
      <div class="container tall-container">
        <h2>Saisie du salaire pour chaque année</h2>
        <div class="salary-grid">
          <!-- Header Row -->
          <p><strong>Âge</strong></p>
          <p><strong>Année</strong></p>
          <p><strong>Saisie ($)</strong></p>
          <p><strong>Pourcentage</strong></p>
          <p><strong>Salaire</strong></p>
          
          <!-- Data Rows - Age 17 to 72 -->
          <p id="age_17">17</p><p id="year_17">2024</p><input type="number" id="salary_17" value="0" min="0"><p id="percentage_17">114%</p><p id="computed_salary_17">0</p>
          <p>18</p><p id="year_18">2025</p><input type="number" id="salary_18" value="0" min="0"><p>114%</p><p id="computed_salary_18">0</p>
          <p>19</p><p id="year_19">2026</p><input type="number" id="salary_19" value="0" min="0"><p>114%</p><p id="computed_salary_19">0</p>
          <p>20</p><p id="year_20">2027</p><input type="number" id="salary_20" value="0" min="0"><p>114%</p><p id="computed_salary_20">0</p>
          <p>21</p><p id="year_21">2028</p><input type="number" id="salary_21" value="0" min="0"><p>114%</p><p id="computed_salary_21">0</p>
          <p>22</p><p id="year_22">2029</p><input type="number" id="salary_22" value="0" min="0"><p>114%</p><p id="computed_salary_22">0</p>
          <p>23</p><p id="year_23">2030</p><input type="number" id="salary_23" value="0" min="0"><p>114%</p><p id="computed_salary_23">0</p>
          <p>24</p><p id="year_24">2031</p><input type="number" id="salary_24" value="0" min="0"><p>114%</p><p id="computed_salary_24">0</p>
          <p>25</p><p id="year_25">2032</p><input type="number" id="salary_25" value="0" min="0"><p>114%</p><p id="computed_salary_25">0</p>
          <p>26</p><p id="year_26">2033</p><input type="number" id="salary_26" value="0" min="0"><p>114%</p><p id="computed_salary_26">0</p>
          <p>27</p><p id="year_27">2034</p><input type="number" id="salary_27" value="0" min="0"><p>114%</p><p id="computed_salary_27">0</p>
          <p>28</p><p id="year_28">2035</p><input type="number" id="salary_28" value="0" min="0"><p>114%</p><p id="computed_salary_28">0</p>
          <p>29</p><p id="year_29">2036</p><input type="number" id="salary_29" value="0" min="0"><p>114%</p><p id="computed_salary_29">0</p>
          <p>30</p><p id="year_30">2037</p><input type="number" id="salary_30" value="0" min="0"><p>114%</p><p id="computed_salary_30">0</p>
          <p>31</p><p id="year_31">2038</p><input type="number" id="salary_31" value="0" min="0"><p>114%</p><p id="computed_salary_31">0</p>
          <p>32</p><p id="year_32">2039</p><input type="number" id="salary_32" value="0" min="0"><p>114%</p><p id="computed_salary_32">0</p>
          <p>33</p><p id="year_33">2040</p><input type="number" id="salary_33" value="0" min="0"><p>114%</p><p id="computed_salary_33">0</p>
          <p>34</p><p id="year_34">2041</p><input type="number" id="salary_34" value="0" min="0"><p>114%</p><p id="computed_salary_34">0</p>
          <p>35</p><p id="year_35">2042</p><input type="number" id="salary_35" value="0" min="0"><p>114%</p><p id="computed_salary_35">0</p>
          <p>36</p><p id="year_36">2043</p><input type="number" id="salary_36" value="0" min="0"><p>114%</p><p id="computed_salary_36">0</p>
          <p>37</p><p id="year_37">2044</p><input type="number" id="salary_37" value="0" min="0"><p>114%</p><p id="computed_salary_37">0</p>
          <p>38</p><p id="year_38">2045</p><input type="number" id="salary_38" value="0" min="0"><p>114%</p><p id="computed_salary_38">0</p>
          <p>39</p><p id="year_39">2046</p><input type="number" id="salary_39" value="0" min="0"><p>114%</p><p id="computed_salary_39">0</p>
          <p>40</p><p id="year_40">2047</p><input type="number" id="salary_40" value="0" min="0"><p>114%</p><p id="computed_salary_40">0</p>
          <p>41</p><p id="year_41">2048</p><input type="number" id="salary_41" value="0" min="0"><p>114%</p><p id="computed_salary_41">0</p>
          <p>42</p><p id="year_42">2049</p><input type="number" id="salary_42" value="0" min="0"><p>114%</p><p id="computed_salary_42">0</p>
          <p>43</p><p id="year_43">2050</p><input type="number" id="salary_43" value="0" min="0"><p>114%</p><p id="computed_salary_43">0</p>
          <p>44</p><p id="year_44">2051</p><input type="number" id="salary_44" value="0" min="0"><p>114%</p><p id="computed_salary_44">0</p>
          <p>45</p><p id="year_45">2052</p><input type="number" id="salary_45" value="0" min="0"><p>114%</p><p id="computed_salary_45">0</p>
          <p>46</p><p id="year_46">2053</p><input type="number" id="salary_46" value="0" min="0"><p>114%</p><p id="computed_salary_46">0</p>
          <p>47</p><p id="year_47">2054</p><input type="number" id="salary_47" value="0" min="0"><p>114%</p><p id="computed_salary_47">0</p>
          <p>48</p><p id="year_48">2055</p><input type="number" id="salary_48" value="0" min="0"><p>114%</p><p id="computed_salary_48">0</p>
          <p>49</p><p id="year_49">2056</p><input type="number" id="salary_49" value="0" min="0"><p>114%</p><p id="computed_salary_49">0</p>
          <p>50</p><p id="year_50">2057</p><input type="number" id="salary_50" value="0" min="0"><p>114%</p><p id="computed_salary_50">0</p>
          <p>51</p><p id="year_51">2058</p><input type="number" id="salary_51" value="0" min="0"><p>114%</p><p id="computed_salary_51">0</p>
          <p>52</p><p id="year_52">2059</p><input type="number" id="salary_52" value="0" min="0"><p>114%</p><p id="computed_salary_52">0</p>
          <p>53</p><p id="year_53">2060</p><input type="number" id="salary_53" value="0" min="0"><p>114%</p><p id="computed_salary_53">0</p>
          <p>54</p><p id="year_54">2061</p><input type="number" id="salary_54" value="0" min="0"><p>114%</p><p id="computed_salary_54">0</p>
          <p>55</p><p id="year_55">2062</p><input type="number" id="salary_55" value="0" min="0"><p>114%</p><p id="computed_salary_55">0</p>
          <p>56</p><p id="year_56">2063</p><input type="number" id="salary_56" value="0" min="0"><p>114%</p><p id="computed_salary_56">0</p>
          <p>57</p><p id="year_57">2064</p><input type="number" id="salary_57" value="0" min="0"><p>114%</p><p id="computed_salary_57">0</p>
          <p>58</p><p id="year_58">2065</p><input type="number" id="salary_58" value="0" min="0"><p>114%</p><p id="computed_salary_58">0</p>
          <p>59</p><p id="year_59">2066</p><input type="number" id="salary_59" value="0" min="0"><p>114%</p><p id="computed_salary_59">0</p>
          <p>60</p><p id="year_60">2067</p><input type="number" id="salary_60" value="0" min="0"><p>114%</p><p id="computed_salary_60">0</p>
          <p>61</p><p id="year_61">2068</p><input type="number" id="salary_61" value="0" min="0"><p>114%</p><p id="computed_salary_61">0</p>
          <p>62</p><p id="year_62">2069</p><input type="number" id="salary_62" value="0" min="0"><p>114%</p><p id="computed_salary_62">0</p>
          <p>63</p><p id="year_63">2070</p><input type="number" id="salary_63" value="0" min="0"><p>114%</p><p id="computed_salary_63">0</p>
          <p>64</p><p id="year_64">2071</p><input type="number" id="salary_64" value="0" min="0"><p>114%</p><p id="computed_salary_64">0</p>
          <p>65</p><p id="year_65">2072</p><input type="number" id="salary_65" value="0" min="0"><p>114%</p><p id="computed_salary_65">0</p>
          <p>66</p><p id="year_66">2073</p><input type="number" id="salary_66" value="0" min="0"><p>114%</p><p id="computed_salary_66">0</p>
          <p>67</p><p id="year_67">2074</p><input type="number" id="salary_67" value="0" min="0"><p>114%</p><p id="computed_salary_67">0</p>
          <p>68</p><p id="year_68">2075</p><input type="number" id="salary_68" value="0" min="0"><p>114%</p><p id="computed_salary_68">0</p>
          <p>69</p><p id="year_69">2076</p><input type="number" id="salary_69" value="0" min="0"><p>114%</p><p id="computed_salary_69">0</p>
          <p>70</p><p id="year_70">2077</p><input type="number" id="salary_70" value="0" min="0"><p>114%</p><p id="computed_salary_70">0</p>
          <p>71</p><p id="year_71">2078</p><input type="number" id="salary_71" value="0" min="0"><p>114%</p><p id="computed_salary_71">0</p>
          <p>72</p><p id="year_72">2079</p><input type="number" id="salary_72" value="0" min="0"><p>114%</p><p id="computed_salary_72">0</p>
        </div>

      </div>
    </div>
  </div>

  <!-- Results Section -->
  <div class="results-section">
    <div class="results-container">
      <h2>Résultats de la simulation</h2>
      <div id="simulation-results" class="results-wrapper">
        <!-- Loading overlay -->
        <div id="loading-overlay" class="loading-overlay hidden">
          <div class="loading-spinner"></div>
          <p class="loading-text">Simulation en cours...</p>
        </div>
        <div class="results-table">
          <!-- Prestation annuelle spanning header -->
          <div class="results-header"></div>
          <div class="results-header"></div>
          <div class="results-header"></div>
          <div class="results-header"></div>
          <div class="results-header"></div>
          <div class="results-header"></div>
          <div class="results-header"></div>
          <div class="results-header prestation-header" title="Montant total des prestations annuelles">Prestation annuelle</div>
          <div class="results-header"></div>
          
          <!-- Header Row -->
          <div class="results-header" title="Âge de la personne pour cette année de calcul">Âge</div>
          <div class="results-header" title="Année civile correspondant à cet âge">Année</div>
          <div class="results-header" title="Taux de rendement interne calculé pour cette année, exprimé en pourcentage">Taux de rendement interne</div>
          <div class="results-header" title="Salaire admissible au Régime de rentes du Québec (RRQ) pour cette année">Salaire admissible</div>
          <div class="results-header" title="Maximum des gains annuels (MGA) - plafond de cotisation au RRQ pour cette année">MGA</div>
          <div class="results-header" title="Maximum du salaire admissible (MSGA) - seuil d'exemption de base du RRQ">MSGA</div>
          <div class="results-header" title="Montant de la cotisation annuelle au RRQ en dollars de l'année courante">Cotisation annuelle<br><small>En dollars courant</small></div>
          <div class="results-header" title="Montant accumulé des prestations RRQ en dollars constants de 2064">Accumulée<br><small>En dollars de 2064</small></div>
          <div class="results-header" title="Montant additionnel des prestations RRQ pour cette année en dollars constants de 2064">Additionnelle<br><small>En dollars de 2064</small></div>
          <div class="results-header" title="Montant accumulé des prestations RRQ en dollars constants de 2025">Accumulée<br><small>En dollars de 2025</small></div>
          <div class="results-header" title="Montant additionnel des prestations RRQ pour cette année en dollars constants de 2025">Additionnelle<br><small>En dollars de 2025</small></div>
          <div class="results-header" title="Nombre d'années restantes avant l'âge de retraite choisi">Nombre d'année avant la retraite</div>
          
          <!-- Sample Data Rows (we'll replace with real data later) -->
          <div class="results-cell">28</div>
          <div class="results-cell">2025</div>
          <div class="results-cell">6,06%</div>
          <div class="results-cell">20000</div>
          <div class="results-cell">66580</div>
          <div class="results-cell">81200</div>
          <div class="results-cell">-1056</div>
          <div class="results-cell">6546</div>
          <div class="results-cell">648</div>
          <div class="results-cell">1973</div>
          <div class="results-cell">195</div>
          <div class="results-cell">40</div>
          
          <div class="results-cell">29</div>
          <div class="results-cell">2026</div>
          <div class="results-cell">6,13%</div>
          <div class="results-cell">20000</div>
          <div class="results-cell">68960</div>
          <div class="results-cell">83700</div>
          <div class="results-cell">-1056</div>
          <div class="results-cell">7194</div>
          <div class="results-cell">628</div>
          <div class="results-cell">2168</div>
          <div class="results-cell">189</div>
          <div class="results-cell">39</div>
          
          <div class="results-cell">30</div>
          <div class="results-cell">2027</div>
          <div class="results-cell">6,19%</div>
          <div class="results-cell">20000</div>
          <div class="results-cell">71140</div>
          <div class="results-cell">86400</div>
          <div class="results-cell">-1056</div>
          <div class="results-cell">7822</div>
          <div class="results-cell">609</div>
          <div class="results-cell">2357</div>
          <div class="results-cell">184</div>
          <div class="results-cell">38</div>
          
          <div class="results-cell">31</div>
          <div class="results-cell">2028</div>
          <div class="results-cell">6,26%</div>
          <div class="results-cell">20000</div>
          <div class="results-cell">73440</div>
          <div class="results-cell">89000</div>
          <div class="results-cell">-1056</div>
          <div class="results-cell">8431</div>
          <div class="results-cell">591</div>
          <div class="results-cell">2541</div>
          <div class="results-cell">178</div>
          <div class="results-cell">37</div>
          
          <div class="results-cell">32</div>
          <div class="results-cell">2029</div>
          <div class="results-cell">6,32%</div>
          <div class="results-cell">20000</div>
          <div class="results-cell">75860</div>
          <div class="results-cell">91800</div>
          <div class="results-cell">-1056</div>
          <div class="results-cell">9022</div>
          <div class="results-cell">573</div>
          <div class="results-cell">2719</div>
          <div class="results-cell">173</div>
          <div class="results-cell">36</div>
          
          <div class="results-cell">33</div>
          <div class="results-cell">2030</div>
          <div class="results-cell">6,39%</div>
          <div class="results-cell">20000</div>
          <div class="results-cell">78220</div>
          <div class="results-cell">94700</div>
          <div class="results-cell">-1056</div>
          <div class="results-cell">9595</div>
          <div class="results-cell">555</div>
          <div class="results-cell">2892</div>
          <div class="results-cell">167</div>
          <div class="results-cell">35</div>
          
          <div class="results-cell">34</div>
          <div class="results-cell">2031</div>
          <div class="results-cell">6,47%</div>
          <div class="results-cell">20000</div>
          <div class="results-cell">80640</div>
          <div class="results-cell">97500</div>
          <div class="results-cell">-1056</div>
          <div class="results-cell">10150</div>
          <div class="results-cell">539</div>
          <div class="results-cell">3059</div>
          <div class="results-cell">163</div>
          <div class="results-cell">34</div>
          
          <div class="results-cell">35</div>
          <div class="results-cell">2032</div>
          <div class="results-cell">6,55%</div>
          <div class="results-cell">20000</div>
          <div class="results-cell">83140</div>
          <div class="results-cell">100600</div>
          <div class="results-cell">-1056</div>
          <div class="results-cell">10690</div>
          <div class="results-cell">523</div>
          <div class="results-cell">3222</div>
          <div class="results-cell">158</div>
          <div class="results-cell">33</div>
          
          <div class="results-cell">36</div>
          <div class="results-cell">2033</div>
          <div class="results-cell">6,63%</div>
          <div class="results-cell">20000</div>
          <div class="results-cell">85720</div>
          <div class="results-cell">103700</div>
          <div class="results-cell">-1056</div>
          <div class="results-cell">11212</div>
          <div class="results-cell">507</div>
          <div class="results-cell">3379</div>
          <div class="results-cell">153</div>
          <div class="results-cell">32</div>
          
          <div class="results-cell">37</div>
          <div class="results-cell">2034</div>
          <div class="results-cell">6,72%</div>
          <div class="results-cell">20000</div>
          <div class="results-cell">88380</div>
          <div class="results-cell">107000</div>
          <div class="results-cell">-1056</div>
          <div class="results-cell">11720</div>
          <div class="results-cell">492</div>
          <div class="results-cell">3532</div>
          <div class="results-cell">148</div>
          <div class="results-cell">31</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Back to Top Button -->
  <button id="backToTop" class="back-to-top-btn hidden" title="Retour en haut">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <polyline points="18,15 12,9 6,15"></polyline>
    </svg>
  </button>

  <script src="script.js"></script>
  <script>
    // Year validation
    document.addEventListener('DOMContentLoaded', function() {
      const yearInput = document.getElementById('inputCurrentYear');
      const ageExpInput = document.getElementById('AgeExp');
      const beforeCurrentYearInput = document.getElementById('BeforeCurrentYear');
      const birthInput = document.getElementById('inputBirth');
      const currentYear = new Date().getFullYear();
      
      // Set current year as default
      yearInput.value = currentYear;
      
      // Function to update salary grid years based on birth date
      function updateSalaryGridYears() {
        const birthDateValue = birthInput.value;
        if (birthDateValue) {
          // Parse the date more reliably by splitting the string
          const dateParts = birthDateValue.split('-');
          if (dateParts.length === 3) {
            const birthYear = parseInt(dateParts[0]);
            const birthMonth = parseInt(dateParts[1]); // Already 1-12 format
            const birthDay = parseInt(dateParts[2]);
            
            console.log('Birth date parsed:', { birthYear, birthMonth, birthDay }); // Debug log
            
            // Update years for ages 17 to 72
            for (let age = 17; age <= 72; age++) {
              const yearElement = document.getElementById(`year_${age}`);
              if (yearElement) {
                yearElement.textContent = birthYear + age + 1;
              }
            }
            
            // Handle graying out for age 17 if birth month is December (12)
            const age17Elements = [
              document.getElementById('age_17'),
              document.getElementById('year_17'),
              document.getElementById('salary_17'),
              document.getElementById('percentage_17'),
              document.getElementById('computed_salary_17')
            ];
            
            if (birthMonth === 12) {
              // Gray out age 17 row and disable input
              age17Elements.forEach(element => {
                if (element) {
                  element.classList.add('grayed-out');
                }
              });
              const salary17Input = document.getElementById('salary_17');
              if (salary17Input) {
                salary17Input.disabled = true;
              }
            } else {
              // Remove gray out and enable input
              age17Elements.forEach(element => {
                if (element) {
                  element.classList.remove('grayed-out');
                }
              });
              const salary17Input = document.getElementById('salary_17');
              if (salary17Input) {
                salary17Input.disabled = false;
              }
            }
          }
        }
      }
      
      // Listen for birth date changes
      birthInput.addEventListener('change', updateSalaryGridYears);
      birthInput.addEventListener('input', updateSalaryGridYears);
      
      // Initialize years on page load if birth date is already set
      updateSalaryGridYears();
      
      // Debug logging for BeforeCurrentYear field
      beforeCurrentYearInput.addEventListener('input', function() {
        console.log('BeforeCurrentYear input changed to:', this.value);
      });
      
      beforeCurrentYearInput.addEventListener('change', function() {
        console.log('BeforeCurrentYear change event, value:', this.value);
      });
      
      beforeCurrentYearInput.addEventListener('blur', function() {
        console.log('BeforeCurrentYear blur event, value:', this.value);
      });
      
      // Year input validation
      yearInput.addEventListener('input', function() {
        const value = parseInt(this.value);
        
        // Remove invalid characters (keep only numbers)
        this.value = this.value.replace(/[^0-9]/g, '');
        
        // Limit to 4 digits
        if (this.value.length > 4) {
          this.value = this.value.slice(0, 4);
        }
      });
      
      // Year input blur validation
      yearInput.addEventListener('blur', function() {
        const value = parseInt(this.value);
        
        if (isNaN(value) || value < 1900 || value > 2100) {
          this.setCustomValidity('Veuillez entrer une année valide entre 1900 et 2100');
          this.reportValidity(); // Shows the tooltip
          this.value = currentYear; // Reset to current year
        } else {
          this.setCustomValidity(''); // Clear any previous custom validity
        }
      });
      
      // Age expectancy validation
      ageExpInput.addEventListener('blur', function() {
        const value = parseInt(this.value);
        const defaultValue = 85;
        
        if (!Number.isInteger(Number(this.value)) || value < 60 || value > 120) {
          this.setCustomValidity('Veuillez entrer un âge valide entre 60 et 120');
          this.reportValidity(); // Shows the tooltip
          this.value = defaultValue; // Reset to default value (85)
        } else {
          this.setCustomValidity(''); // Clear any previous custom validity
        }
      });
    });
    
    // Launch simulation button functionality
    document.addEventListener('DOMContentLoaded', function() {
      const launchButton = document.getElementById('launchSimulation');
      const resultsSection = document.querySelector('.results-section');
      const loadingOverlay = document.getElementById('loading-overlay');
      const resultsWrapper = document.getElementById('simulation-results');
      const resultsTable = document.querySelector('.results-table');
      
      launchButton.addEventListener('click', function() {
        // Show results section if it's the first time
        if (!resultsSection.classList.contains('visible')) {
          resultsSection.classList.add('visible');
        }
        
        // Show loading indicator
        loadingOverlay.classList.remove('hidden');
        resultsWrapper.classList.add('loading');
        
        // Prepare results table for animation
        resultsTable.classList.add('fade-in');
        resultsTable.classList.remove('show');
        
        // Disable button during simulation
        launchButton.disabled = true;
        launchButton.textContent = 'Simulation en cours...';
        
        // Get current scroll position and target position
        const startPosition = window.pageYOffset;
        const targetPosition = resultsSection.offsetTop;
        const distance = targetPosition - startPosition;
        const duration = 1000; // 1 second
        let start = null;
        
        // Smooth scroll animation function
        function smoothScroll(timestamp) {
          if (!start) start = timestamp;
          const progress = timestamp - start;
          const percentage = Math.min(progress / duration, 1);
          
          // Easing function for smooth animation
          const ease = percentage < 0.5 
            ? 2 * percentage * percentage 
            : 1 - Math.pow(-2 * percentage + 2, 2) / 2;
          
          window.scrollTo(0, startPosition + (distance * ease));
          
          if (progress < duration) {
            requestAnimationFrame(smoothScroll);
          }
        }
        
        // Start the animation
        requestAnimationFrame(smoothScroll);
        
        // TODO: Here we'll add the actual simulation logic later
        // For now, we'll simulate a delay to show the loading state
        setTimeout(function() {
          // Hide loading indicator
          loadingOverlay.classList.add('hidden');
          resultsWrapper.classList.remove('loading');
          
          // Animate results appearing
          setTimeout(function() {
            resultsTable.classList.remove('fade-in');
            resultsTable.classList.add('show');
          }, 100); // Small delay to ensure loading overlay is hidden first
          
          // Re-enable button
          launchButton.disabled = false;
          launchButton.textContent = 'Lancer la simulation';
          
          // TODO: Replace this with actual simulation results
          console.log('Simulation completed - results would be populated here');
        }, 3000); // 3 second delay to demonstrate loading
      });
    });
    
    // Custom tooltip functionality
    document.addEventListener('DOMContentLoaded', function() {
      // Create tooltip element
      const tooltip = document.createElement('div');
      tooltip.className = 'custom-tooltip';
      document.body.appendChild(tooltip);
      
      // Add event listeners to all results headers with title attributes
      const headersWithTooltips = document.querySelectorAll('.results-header[title]');
      
      headersWithTooltips.forEach(header => {
        // Store the title content and remove the title attribute to prevent default tooltip
        const titleContent = header.getAttribute('title');
        header.removeAttribute('title');
        header.setAttribute('data-tooltip', titleContent);
        
        header.addEventListener('mouseenter', function(e) {
          const title = this.getAttribute('data-tooltip');
          tooltip.textContent = title;
          tooltip.classList.add('show');
          
          // Position tooltip
          const rect = this.getBoundingClientRect();
          const tooltipRect = tooltip.getBoundingClientRect();
          
          // Calculate ideal centered position
          let idealLeft = rect.left + (rect.width / 2) - (280 / 2);
          let top = rect.top - tooltipRect.height - 15;
          
          // Adjust for viewport boundaries
          let actualLeft = idealLeft;
          if (actualLeft < 10) actualLeft = 10;
          if (actualLeft + 280 > window.innerWidth - 10) {
            actualLeft = window.innerWidth - 290;
          }
          
          // Position below if no space above
          let showBelow = false;
          if (top < 10) {
            top = rect.bottom + 15;
            showBelow = true;
          }
          
          tooltip.style.left = actualLeft + 'px';
          tooltip.style.top = top + 'px';
          
          // Calculate arrow position relative to the element center
          const elementCenter = rect.left + (rect.width / 2);
          const tooltipLeft = actualLeft;
          const arrowLeft = elementCenter - tooltipLeft;
          
          // Clamp arrow position to stay within tooltip bounds (with some margin)
          const clampedArrowLeft = Math.max(20, Math.min(260, arrowLeft));
          
          // Update arrow position
          const existingArrow = tooltip.querySelector('.tooltip-arrow');
          if (existingArrow) {
            existingArrow.remove();
          }
          
          const arrow = document.createElement('div');
          arrow.className = 'tooltip-arrow';
          arrow.style.position = 'absolute';
          arrow.style.left = clampedArrowLeft + 'px';
          arrow.style.transform = 'translateX(-50%)';
          arrow.style.border = '8px solid transparent';
          
          if (showBelow) {
            arrow.style.top = '-16px';
            arrow.style.borderBottomColor = '#2c3e50';
          } else {
            arrow.style.bottom = '-16px';
            arrow.style.borderTopColor = '#2c3e50';
          }
          
          tooltip.appendChild(arrow);
        });
        
        header.addEventListener('mouseleave', function() {
          tooltip.classList.remove('show');
        });
      });
    });
    
    // Results table row/column highlighting
    document.addEventListener('DOMContentLoaded', function() {
      function addTableHoverEffects() {
        const resultsTable = document.querySelector('.results-table');
        if (!resultsTable) return;
        
        // Add mousemove listener to the entire table container
        resultsTable.addEventListener('mousemove', function(e) {
          handleTableHover(e);
        });
        
        resultsTable.addEventListener('mouseleave', function() {
          clearHighlights();
        });
      }
      
      function handleTableHover(e) {
        const resultsTable = e.currentTarget;
        const rect = resultsTable.getBoundingClientRect();
        const allCells = Array.from(resultsTable.children);
        
        // Calculate mouse position relative to table
        const mouseX = e.clientX - rect.left;
        const mouseY = e.clientY - rect.top;
        
        // Find the closest cell based on mouse position
        let closestCell = null;
        let closestDistance = Infinity;
        let closestIndex = -1;
        
        allCells.forEach((cell, index) => {
          const cellRect = cell.getBoundingClientRect();
          const cellX = cellRect.left - rect.left + cellRect.width / 2;
          const cellY = cellRect.top - rect.top + cellRect.height / 2;
          
          const distance = Math.sqrt(Math.pow(mouseX - cellX, 2) + Math.pow(mouseY - cellY, 2));
          
          if (distance < closestDistance) {
            closestDistance = distance;
            closestCell = cell;
            closestIndex = index;
          }
        });
        
        if (closestCell) {
          highlightRowAndColumn(closestIndex, allCells);
        }
      }
      
      function highlightRowAndColumn(cellIndex, allCells) {
        const totalColumns = 12;
        
        // Find the actual data start (skip the spanning header row)
        let dataStartIndex = 0;
        let foundMainHeaders = false;
        
        // Look for the main header row (starts with "Âge")
        for (let i = 0; i < allCells.length; i++) {
          if (allCells[i].textContent.trim() === 'Âge') {
            dataStartIndex = i;
            foundMainHeaders = true;
            break;
          }
        }
        
        // If we're in the spanning header area, use different logic
        if (cellIndex < dataStartIndex) {
          // Just highlight the current cell for spanning headers
          clearHighlights();
          allCells[cellIndex].classList.add('highlight-intersection');
          return;
        }
        
        // Calculate row and column relative to the main data area
        const relativeIndex = cellIndex - dataStartIndex;
        const currentRow = Math.floor(relativeIndex / totalColumns);
        const currentCol = relativeIndex % totalColumns;
        const isHeaderRow = currentRow === 0; // Check if we're on the header row
        
        clearHighlights();
        
        // Highlight cells in the main data area
        for (let i = dataStartIndex; i < allCells.length; i++) {
          const relIdx = i - dataStartIndex;
          const cellRow = Math.floor(relIdx / totalColumns);
          const cellCol = relIdx % totalColumns;
          
          // Highlight current row (but skip if hovering over header)
          if (cellRow === currentRow && !isHeaderRow) {
            allCells[i].classList.add('highlight-row');
          }
          
          // Highlight current column (always show column highlight)
          if (cellCol === currentCol) {
            allCells[i].classList.add('highlight-col');
          }
          
          // Highlight intersection (current cell)
          if (cellRow === currentRow && cellCol === currentCol) {
            allCells[i].classList.add('highlight-intersection');
          }
        }
        
        // Always highlight the column header when hovering anywhere in that column
        const headerIndex = dataStartIndex + currentCol;
        if (headerIndex < allCells.length) {
          allCells[headerIndex].classList.add('highlight-col');
        }
      }
      
      function clearHighlights() {
        const allCells = document.querySelectorAll('.results-cell, .results-header');
        allCells.forEach(cell => {
          cell.classList.remove('highlight-row', 'highlight-col', 'highlight-intersection');
        });
      }
      
      // Initialize hover effects
      addTableHoverEffects();
      
      // Re-add hover effects after table is updated
      const originalUpdateTable = window.TRICalculator?.prototype?.updateResultsTable;
      if (originalUpdateTable) {
        window.TRICalculator.prototype.updateResultsTable = function(results) {
          originalUpdateTable.call(this, results);
          setTimeout(addTableHoverEffects, 100); // Small delay to ensure DOM is updated
        };
      }
    });
    
    // Back to Top Button functionality
    document.addEventListener('DOMContentLoaded', function() {
      const backToTopBtn = document.getElementById('backToTop');
      
      // Show/hide button based on scroll position
      window.addEventListener('scroll', function() {
        if (window.pageYOffset > 300) {
          backToTopBtn.classList.remove('hidden');
        } else {
          backToTopBtn.classList.add('hidden');
        }
      });
      
      // Smooth scroll to top when clicked
      backToTopBtn.addEventListener('click', function() {
        const startPosition = window.pageYOffset;
        const duration = 800; // 0.8 seconds
        let start = null;
        
        function smoothScrollToTop(timestamp) {
          if (!start) start = timestamp;
          const progress = timestamp - start;
          const percentage = Math.min(progress / duration, 1);
          
          // Easing function for smooth animation
          const ease = percentage < 0.5 
            ? 2 * percentage * percentage 
            : 1 - Math.pow(-2 * percentage + 2, 2) / 2;
          
          window.scrollTo(0, startPosition * (1 - ease));
          
          if (progress < duration) {
            requestAnimationFrame(smoothScrollToTop);
          }
        }
        
        requestAnimationFrame(smoothScrollToTop);
      });
    });
  </script>
</body>
</html>
